
<div class="container">
    <div class="row">
        <div class="col-md-4">
            <ul class="nav flex-column">
                <li class="nav-item">
                  <a class="nav-link active" [routerLink] = "['/dashboard']">Dashboard </a>
                </li>
                <li class="nav-item">
                  <a class="nav-link active" [routerLink] = "['/my-page']">My page</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" [routerLink] = "['/users']">Users</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" [routerLink] = "['/login']" (click)="deleteStorage()" style="color:black">Log out</a>
                </li>
              </ul>
        </div>
        <div class="col-md-8">
            <div class="newBtn">
                <button class="btn btn-success"(click)="openModal(template)">Add new user</button>
            </div>
            <ng-template #template>
                <div class="modal-header">
                  <h4 class="modal-title pull-left">Add new user</h4>
                  <button type="button" class="close pull-right" aria-label="Close" (click)="modalRef.hide()">
                    <span aria-hidden="true">&times;</span>
                  </button>
                </div>
                <form #newUserAdmForm = 'ngForm' (ngSubmit) = addUser() *ngIf="ifAdmin">
                    <div class="modal-body">
                        <div class="form-group">
                            <label>Name:</label>
                            <input type="text" 
                                class="form-control"  
                                [(ngModel)]="newUserAdm.name" 
                                required 
                                #name='ngModel'
                                pattern="^[a-zA-Z]{1,23}$"
                                name="newNameAdm">
                        </div>
                        <div *ngIf="name.invalid && name.touched">
                            <small> Name invalid</small>
                        </div>
                        <div class="form-group">
                            <label>Username:</label>
                            <input type="text" 
                                class="form-control"  
                                [(ngModel)]="newUserAdm.username" 
                                required 
                                #name='ngModel'
                                pattern="^[a-zA-Z]{1,23}$"
                                name="newUserNameAdm">
                        </div>
                        <div *ngIf="newUserNameAdm.invalid && newUserNameAdm.touched">
                            <small> Username invalid</small>
                        </div>
                        <div class="form-group">
                            <label>Email:</label>
                            <input type="email" 
                                class="form-control" 
                                name="newEmailAdm" 
                                [(ngModel)]="newUserAdm.email"
                                pattern="[^@]+@[^\.]+\..+"
                                #email='ngModel'
                                required>
                        </div>
                        <div *ngIf="email.invalid && email.touched">
                            <small> Email invalid</small>
                        </div>
                        <div class="form-group">
                            <label>Password:</label>
                            <input type="password" 
                                class="form-control" 
                                name="newPasswordAdm" 
                                [(ngModel)]="newUserAdm.password"
                                required
                                minlength="5"
                                #password='ngModel'>
                        </div>
                        <div *ngIf="password.invalid && password.touched">
                            <small> Password invalid</small>
                        </div>
                        <div>
                          <div class="custom-control custom-radio">
                            <input type="radio" id="customRadio1" value = 'user' name='role' [(ngModel)]="role" class="custom-control-input" (change) ='getRole()'>
                            <label class="custom-control-label" for="customRadio1">User</label>
                          </div>
                          <div class="custom-control custom-radio">
                            <input type="radio" id="customRadio2" value = 'admin' name='role' [(ngModel)]="role" name="customRadio" (change) ='getRole1()' class="custom-control-input">
                            <label class="custom-control-label" for="customRadio2">Admin</label>
                          </div>
                        </div>
                        <div *ngIf="ifselectUser">
                          <div  class="form-check form-check-inline">
                            <input class="form-check-input" type="checkbox" id="1" (change)="selected('can_view_users')">
                            <label class="form-check-label" for="1">can_view_users</label>
                          </div>
                          <div class="form-check form-check-inline">
                            <input class="form-check-input" type="checkbox" id="2" (change)="selected('can_edit_users')">
                            <label class="form-check-label" for="2">can_edit_users</label>
                          </div>
                          <div class="form-check form-check-inline">
                            <input class="form-check-input" type="checkbox" id="3" (change)="selected('can_delete_users')">
                            <label class="form-check-label" for="3">can_delete_users</label>
                          </div>
                          <div class="form-check form-check-inline">
                            <input class="form-check-input" type="checkbox" id="4" (change)="selected('can_view_details')">
                            <label class="form-check-label" for="4">can_view_details</label>
                          </div>
                          <div class="form-check form-check-inline">
                            <input class="form-check-input" type="checkbox" id="5" (change)="selected('can_view_details_full')">
                            <label class="form-check-label" for="5">can_view_details_full</label>
                          </div>
                          <div class="form-check form-check-inline">
                            <input class="form-check-input" type="checkbox" id="6" (change)="selected('can_edit_users_full')">
                            <label class="form-check-label" for="6">can_edit_users_full</label>
                          </div>
                        </div>
                        <div class="newBtn">
                            <button type="submit" 
                                [disabled] = 'newUserAdmForm.invalid' 
                                class="btn btn-warning"
                                (click)="modalRef.hide()">Add</button>
                        </div>
                    </div>
                </form>
                <form #newUserUserForm = 'ngForm' *ngIf="ifUser" (ngSubmit) = addUser()>
                    <div class="modal-body">
                        <div class="form-group">
                            <label>Name:</label>
                            <input type="text" 
                                class="form-control"  
                                [(ngModel)]="newUserUser.name" 
                                required 
                                #name='ngModel'
                                pattern="^[a-zA-Z]{1,23}$"
                                name="newNameUser">
                        </div>
                        <div *ngIf="name.invalid && name.touched">
                            <small> Name invalid</small>
                        </div>
                        <div class="form-group">
                            <label>Username:</label>
                            <input type="text" 
                                class="form-control"  
                                [(ngModel)]="newUserUser.username" 
                                required 
                                #name='ngModel'
                                pattern="^[a-zA-Z]{1,23}$"
                                name="newUserNameUser">
                        </div>
                        <div *ngIf="newUserNameUser.invalid && newUserNameUser.touched">
                            <small> Username invalid</small>
                        </div>
                        <div class="form-group">
                            <label>Email:</label>
                            <input type="email" 
                                class="form-control" 
                                name="newEmailUser" 
                                [(ngModel)]="newUserUser.email"
                                pattern="[^@]+@[^\.]+\..+"
                                #email='ngModel'
                                required>
                        </div>
                        <div *ngIf="email.invalid && email.touched">
                            <small> Email invalid</small>
                        </div>
                        <div class="form-group">
                            <label>Password:</label>
                            <input type="password" 
                                class="form-control" 
                                name="newPasswordUser" 
                                [(ngModel)]="newUserUser.password"
                                required
                                minlength="5"
                                #password='ngModel'>
                        </div>
                        <div *ngIf="password.invalid && password.touched">
                            <small> Password invalid</small>
                        </div>
                        <div class="newBtn">
                            <button type="submit" 
                                [disabled] = 'newUserUserForm.invalid' 
                                class="btn btn-warning"
                                (click)="modalRef.hide()">Add</button>
                        </div>
                    </div>
                </form>
              </ng-template>
            <table class="table" *ngIf="ifAdmin || ifCanViewUsers">
                <thead>
                  <tr>
                    <th scope="col">#</th>
                    <th scope="col">Name</th>
                    <th *ngIf="ifAdmin || ifCanDelete" scope="col">Delete</th>
                  </tr>
                </thead>
                <tbody>
                  <tr  *ngFor="let user of users" >
                    <th>{{user.id}}</th>
                    <td *ngIf="ifAdmin || ifCanViewDetails"><a [routerLink]="[ '/user/', user.id ]">{{user.name}}</a></td>
                    <td *ngIf="ifUser && !ifCanViewDetails">{{user.name}}</td>
                    <td *ngIf="ifAdmin || ifCanDelete"><button class="btn btn-danger" (click)="openModalDel(del, user)">Delete</button></td>
                    <ng-template #del>
                      <div class="modal-header">
                        <h4 class="modal-title pull-left" style="text-align: center;">Are you sure?</h4>
                        <button type="button" class="close pull-right" aria-label="Close" (click)="modalRef3.hide()">
                          <span aria-hidden="true">&times;</span>
                        </button>
                      </div>
                      <div class="modal-body">
                        <button class="btn btn-danger" (click)="deleteUser()">Yes</button>
                        <button class="btn btn-dark" (click)="modalRef3.hide()">No</button>
                      </div>
                    </ng-template>
                  </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>

